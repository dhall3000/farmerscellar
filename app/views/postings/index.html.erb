<% provide(:title, 'Postings') %>

<h1>Postings</h1>
        
<% count = 0 %>
<% @postings.each do |posting| %> 

  <div class="row">
    <div class="col-xs-12 col-sm-offset-3 col-sm-6">

      <div class="panel panel-default">
        <div class="panel-body">



          <div class="panel-group" id=<%= "#{count.to_s}accordion" %>>
          
            

            <div class="panel panel-default">
              <div class="panel-heading" id=<%= "#{count.to_s}producer_name" %>>
                <h4 class="panel-title" data-toggle="collapse" data-parent=<%= "##{count.to_s}accordion" %> data-target=<%= "##{count.to_s}producerDetails" %>>
                  <%= posting.user.farm_name %><span id=<%= "producerDetailsChevron#{count.to_s}" %> class="glyphicon glyphicon-chevron-down pull-right"></span>            
                </h4>
              </div>
              <div id=<%= "#{count.to_s}producerDetails" %> class="panel-collapse collapse" data-chevron=<%= "#producerDetailsChevron#{count.to_s}" %>>
                <div class="panel-body">
                  <ul class="list-group">
                    <% if !posting.user.city.blank? && !posting.user.state.blank? %>
                      <li class="list-group-item">Location: <%= "#{posting.user.city}, #{posting.user.state}" %></li>              
                    <% end %>
                    <% if !posting.user.website.blank? %>
                      <li class="list-group-item">Website: <a href=<%= "#{posting.user.website}" %> target='_blank'><%= posting.user.website %></a></li>              
                    <% end %>   
                    <% if !posting.user.description.blank? %>                       
                      <li class="list-group-item"><%= posting.user.description %></li>
                    <% end %>
                  </ul>
                </div>
              </div>
            </div>



            <div class="panel panel-default">
              <div class="panel-heading" id=<%= "#{count.to_s}product" %>>
                <h4 class="panel-title" data-toggle="collapse" data-parent=<%= "##{count.to_s}accordion" %> data-target=<%= "##{count.to_s}productDetails" %>>
                  <%= posting.product.name %><span id=<%= "productDetailsChevron#{count.to_s}" %> class="glyphicon glyphicon-chevron-down pull-right"></span>            
                </h4>
              </div>
              <div id=<%= "#{count.to_s}productDetails" %> class="panel-collapse collapse" data-chevron=<%= "#productDetailsChevron#{count.to_s}" %>>                
                <div class="panel-body">
                  <ul class="list-group">
                    <% if !posting.description.blank? %>
                      <li class="list-group-item"><%= posting.description %></li>                
                    <% end %>
                    <% if !posting.description_body.blank? %>
                      <li class="list-group-item"><%= posting.description_body %></li>                
                    <% end %>
                  </ul>
                </div>                
              </div>
            </div>



            <% if !posting.unit_body.blank? || !posting.price_body.blank? %>

              <div class="panel panel-default">
                <div class="panel-heading" id=<%= "#{count.to_s}price" %>>
                  <h4 class="panel-title" data-toggle="collapse" data-parent=<%= "##{count.to_s}accordion" %> data-target=<%= "##{count.to_s}priceDetails" %>>
                      <%= number_to_currency(posting.price) %> / <%= Unit.find_by(id: posting.unit_id).name %>
                      <span id=<%= "priceDetailsChevron#{count.to_s}" %> class="glyphicon glyphicon-chevron-down pull-right"></span>
                  </h4>
                </div>          
                <div id=<%= "#{count.to_s}priceDetails" %> class="panel-collapse collapse" data-chevron=<%= "#priceDetailsChevron#{count.to_s}" %>>
                  <div class="panel-body">
                    <ul class="list-group">
                      <% if !posting.unit_body.blank? %>
                        <li class="list-group-item"><%= posting.unit_body %></li>
                      <% end %>
                      <% if !posting.price_body.blank? %>
                        <li class="list-group-item"><%= posting.price_body %></li>
                      <% end %>
                    </ul>
                  </div>
                </div>                
              </div>

            <% else %>

              <div class="panel panel-default">
                <div class="panel-heading" id=<%= "#{count.to_s}price" %>>
                  <h4 class="panel-title">                          
                    <%= number_to_currency(posting.price) %> / <%= Unit.find_by(id: posting.unit_id).name %>                          
                  </h4>
                </div>          
              </div>

            <% end %>


            <div class="panel panel-default">
              <div class="panel-heading" id=<%= "#{count.to_s}delivery" %>>
                <h4 class="clearfix panel-title" data-toggle="collapse" data-parent=<%= "##{count.to_s}accordion" %> data-target=<%= "##{count.to_s}deliveryDetails" %>>
                  Scheduled Delivery <%= posting.delivery_date.strftime("%a %b %d") %>                  
                  <span id=<%= "deliveryDetailsChevron#{count.to_s}" %> class="glyphicon glyphicon-chevron-down pull-right"></span>
                  <span class="alert-info glyphicon glyphicon-asterisk pull-right"></span>
                </h4>
              </div>          
              <div id=<%= "#{count.to_s}deliveryDetails" %> class="panel-collapse collapse" data-chevron=<%= "#deliveryDetailsChevron#{count.to_s}" %>>
                <div class="panel-body">
                  <ul class="list-group">                            
                    <% if posting.posting_recurrence && posting.posting_recurrence.on %>
                      <li class="list-group-item">
                        Deliveries scheduled <%= PostingRecurrence.frequency[posting.posting_recurrence.frequency][0].downcase %>
                      </li>                    
                    <% end %>
                      <li class="list-group-item">
                        <span class="alert-info glyphicon glyphicon-asterisk"></span> Deliveries occur on schedule subject to several constraints. Please be aware of our <%= link_to "Delivery Not Guaranteed", how_things_work_path(anchor: "delivery_not_guaranteed") %> policy.                        
                      </li>
                  </ul>
                </div>
              </div>                
            </div>





          </div>

          <div>                                                      
            <p><%= link_to "Order", new_tote_item_path(posting_id: posting.id), class: "btn btn-primary btn-lg" %></p>
          </div>


        </div>
      </div>





    </div>
  </div>

  <% count = count + 1 %>
<% end %>