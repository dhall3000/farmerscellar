<h1>Enter Fills</h1>

<div class="row">  
  <div class="col-xs-12">
    <%= link_to "Back", creditor_order_path(@creditor_order) %>
  </div>
</div>

<%= form_tag creditor_order_path(@creditor_order), method: :patch do %>
  <div class="row">  
    <% @creditor_order.postings.joins(:user).order("users.farm_name").each do |posting| %>
      <div class="col-xs-12 col-sm-3">
        <div class="thumbnail">
          <div class="caption">
            <h3>ID</h3>
            <p><%= posting.id.to_s %></p>

            <% if @creditor_order.creditor.distributor? %>            
              <h3>Producer</h3>
              <p><%= posting.user.farm_name %></p>
            <% end %>

            <h3>Product</h3>
            <p><%= posting.product.name %></p>

            <% if posting.product_id_code %>
              <h3>Product ID Code</h3>
              <p><%= posting.product_id_code %></p>
            <% end %>

            <h3>Unit</h3>
            <p><%= posting.unit.name %></p>

            <h3>Units Ordered</h3>
            <p><%= posting.total_quantity_ordered_from_creditor %></p>

            <%
            if posting.units_per_case.nil? || posting.units_per_case < 2
              units_per_case = nil
              num_cases_ordered = nil
            else
              units_per_case = posting.units_per_case.to_s
              num_cases_ordered = posting.inbound_num_cases_ordered.to_s
            end
            %>

            <% if units_per_case %>
              <h3>Case Size</h3>
              <p><%= units_per_case %></p>
            <% end %>

            <% if num_cases_ordered %>
              <h3>Cases Ordered</h3>
              <p><%= num_cases_ordered %></p>
            <% end %>

            <h3>Units Filled</h3>
            <p><%= posting.num_units_filled %></p>          

            <h3>Units to Fill</h3>
            <%= hidden_field_tag "fills[][posting_id]", posting.id.to_s %>
            <%= number_field_tag "fills[][quantity]", posting.num_units_unfilled, class: "input-lg" %>
          </div>
        </div>      
      </div>
    <% end %>
  </div>

  <div class="row">  
    <div class="col-xs-12 col-sm-4">
      <%= submit_tag "Update", class: "btn btn-lg btn-primary outline" %>
    </div>
  </div>

<% end %>