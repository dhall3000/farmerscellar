<nav class="navbar navbar-fixed-top navbar-inverse">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsible-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <%= link_to root_path, id: "logo" do %>
        <span>Farmer's Cellar</span>
        <%= image_tag "/favicon-32.png", id: "headerIcon" %>
      <% end %>
    </div>

    <div class="collapse navbar-collapse" id="collapsible-navbar">    
      <ul class="nav navbar-nav navbar-right">        
        <li><%= link_to "Home", root_path %></li>
        <li><%= link_to "Shop", postings_path %></li>
        <% if logged_in? %>          
          <% if user_has_access?  %>            
            <li>
              <%= link_to tote_items_path do %>
                
                <%
                  unauthorized_items = unauthorized_items_for(current_user)
                  if unauthorized_items.nil? || (num_tote_items = unauthorized_items.count) == 0
                    num_items_string = ""
                  else
                    num_items_string = "#{num_tote_items.to_s}"
                  end
                %>
                <span class="glyphicon glyphicon-shopping-cart"></span><span class="header-object-count"><%= num_items_string %></span>

                <%
                  unauthorized_subscriptions = get_active_subscriptions_by_authorization_state(current_user)[:unauthorized]
                  if unauthorized_subscriptions && (num_unauthorized_subscriptions = unauthorized_subscriptions.count) > 0
                %>
                    <span> <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span><span class="header-object-count"><%= num_unauthorized_subscriptions.to_s %></span></span>
                  <% end %>

                <span> Tote</span>
                              
              <% end %>
            </li>
            <li>
              <%= link_to tote_items_path(orders: true) do %>
                <% if (num_order_objects = num_order_objects(current_user)) > 0 %>
                  Orders (<%= num_order_objects.to_s %>)
                <% else %>
                  Orders
                <% end %>
              <% end %>
            </li>
          <% end %>
          <li class="dropdown">

            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Account <span class="glyphicon glyphicon-menu-down"></span></a>
            
            <ul class="dropdown-menu">
              <li><%= link_to "Subscriptions", subscriptions_path %></li>              
              <% if user_has_access?  %>
                <li><%= link_to "Settings", edit_user_path(current_user) %></li>                
                <li><%= link_to "Info", user_path(current_user) %></li>
                <% if current_user.account_type_is?(:PRODUCER) %>
                  <li><%= link_to "Create new posting", new_posting_path(current_user) %></li>
                <% end %>
              <% end %>
              <li class="divider"></li>
              <li>
                <%= link_to "Log out", logout_path, method: "delete" %>
              </li>
            </ul>
          </li>
        <% else %>
          <li><%= link_to "Log in", login_path %></li>
        <% end %>
      </ul>    

    </div>

  </div>
</nav>