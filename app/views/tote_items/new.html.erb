<h2 id="toteAdditionHeading" class="text-center">Add to Tote</h2>
  
<% if @posting != nil %>
  <% unit = Unit.find_by(id: @posting.unit_id) %>
  <% producer = User.find_by(id: @posting.user_id) %>
  <% provide(:title, producer.farm_name) %>

  <div class="row">
    <div class="col-xs-12 col-md-4 col-md-offset-4">
      <% if @account_on_hold %>
        <p class="text-center alert alert-danger alert-dismissable">
          Your account is on hold, most likely due to a positive balance on your account. Please <%= link_to "contact Farmer's Cellar", contact_path %> to pay your balance before continuing to shop.
        </p>
      <% end %>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12 col-md-4 col-md-offset-4">
      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">





        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="detailsHeading">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#detailsBody" aria-expanded="false" aria-controls="detailsBody">
                <span class="glyphicon glyphicon-expand" aria-hidden="true"></span> Details
              </a>
            </h4>
          </div>          
          <div id="detailsBody" class="panel-collapse collapse" role="tabpanel" aria-labelledby="detailsHeading">
            <div class="panel-body">
              <h3>Order</h3>
              <ul class="list-group">
                <li class="list-group-item"><%= User.find_by(id: @posting.user_id).farm_name %> <%= Product.find_by(id: @posting.product_id).name %></li>
                <li class="list-group-item">
                  <%= number_to_currency(@posting.price) %> / <%= Unit.find_by(id: @posting.unit_id).name %>
                  <% if @posting.unit_equivalency_description || @posting.price_equivalency_description %>
                    <ul>
                      <% if @posting.unit_equivalency_description %>
                        <li><%= @posting.unit_equivalency_description %></li>
                      <% end %>
                      <% if @posting.price_equivalency_description %>
                        <li><%= @posting.price_equivalency_description %></li>
                      <% end %>
                    </ul>
                <% end %>
                </li>
                
                <li class="list-group-item">
                  <% data_content = "This is mostly like an 'order cutoff' but with " + link_to("some important differences", how_things_work_path(anchor: "commitment_zone")) + "." %>

                  <a href='#' class="popover_init" tabindex="0" data-container="body" data-toggle="popover" data-trigger="focus" data-placement="top" data-html="true" data-content="<%=data_content%>">Commitment Zone</a>

                  starts <%= @posting.commitment_zone_start.strftime("%A, %B %-d, %l:%M %p") %>
                </li>
                <li class="list-group-item">Delivery <%= @posting.delivery_date.strftime("%A, %B %-d") %></li>
              </ul>

              <h3>Producer</h3>
              <ul class="list-group">
                <% if !@posting.user.website.blank? %>
                  <li class="list-group-item">Website: <a href=<%= "#{@posting.user.website}" %> target='_blank'><%= @posting.user.website %></a></li>              
                <% end %>   
                <% if @posting.user.description != nil %>                       
                  <li class="list-group-item"><%= @posting.user.description %></li>
                <% end %>
              </ul>

              <h3>Product</h3>
              <ul class="list-group">
                <% if !@posting.description.blank? %>
                  <li class="list-group-item"><%= @posting.description %></a></li>              
                <% end %>                   
              </ul>      

            </div>
          </div>
        </div>












        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="quantityHeading">
            <h4 class="panel-title">Quantity</h4>
          </div>
          <div id="quantityBody" class="panel-body" role="tabpanel" aria-labelledby="quantityHeading">            
            <table id="quantityTable" class="table">
              <thead></thead>                
              <tbody>
                <tr>
                  <td>
                    <%= form_for @tote_item, html: {class: "tote_addition_one_button_form"} do |f| %>
                                            
                      <%= f.number_field :quantity, value: 1, hidden: true %>
                      <%= f.number_field :posting_id, value: @posting.id, hidden: true %>
                      <%= f.number_field :subscription_frequency, value: 0, class: "subscription_frequency", hidden: true %>

                      <%= f.submit "+1", class: "btn btn-primary btn-lg btn-lg", disabled: @account_on_hold %>
                    <% end %>
                  </td>

                  <td>
                    <%= form_for @tote_item, html: {class: "tote_addition_one_button_form"} do |f| %>
                                            
                      <%= f.number_field :quantity, value: 2, hidden: true %>
                      <%= f.number_field :posting_id, value: @posting.id, hidden: true %>
                      <%= f.number_field :subscription_frequency, value: 0, class: "subscription_frequency", hidden: true %>

                      <%= f.submit "+2", class: "btn btn-primary btn-lg", disabled: @account_on_hold %>
                    <% end %>
                  </td>

                  <td>
                    <%= form_for @tote_item, html: {class: "tote_addition_one_button_form"} do |f| %>
                                            
                      <%= f.number_field :quantity, value: 3, hidden: true %>
                      <%= f.number_field :posting_id, value: @posting.id, hidden: true %>
                      <%= f.number_field :subscription_frequency, value: 0, class: "subscription_frequency", hidden: true %>

                      <%= f.submit "+3", class: "btn btn-primary btn-lg", disabled: @account_on_hold %>
                    <% end %>
                  </td>

                  <td>
                    <%= form_for @tote_item, html: {class: "tote_addition_one_button_form"} do |f| %>
                                            
                      <%= f.number_field :quantity, value: 4, hidden: true %>
                      <%= f.number_field :posting_id, value: @posting.id, hidden: true %>
                      <%= f.number_field :subscription_frequency, value: 0, class: "subscription_frequency", hidden: true %>

                      <%= f.submit "+4", class: "btn btn-primary btn-lg", disabled: @account_on_hold %>
                    <% end %>
                  </td>
                </tr>
              </tbody>
            </table>

            <div id="customQuantityFormDiv">

              <%= form_for @tote_item do |f| %>
                <%= render partial: 'shared/error_messages_general', locals: { active_record_object: @tote_item } %>
                
                <%= f.number_field :quantity, class: "form-control fat-finger-spacing", placeholder: "Enter custom quantity" %>
                <%= f.number_field :posting_id, value: @posting.id, hidden: true %>                
                <%= f.number_field :subscription_frequency, value: 0, class: "subscription_frequency", hidden: true %>

                <%= f.submit "Add to Tote", class: "btn btn-primary btn-lg", disabled: @account_on_hold %>
              <% end %>

            </div>
                        
          </div>
        </div>    
















      </div>
    </div>
  </div>
<% end %>